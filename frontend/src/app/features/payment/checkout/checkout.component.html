<!-- checkout.component.html -->
<div class="checkout-container">
  <div class="checkout-form">
    <h2>Checkout</h2>

    <div class="order-summary">
      <h3>Order Summary</h3>
      <div class="order-total">
        <span>Total:</span>
        <span>${{ amount / 100 }}.00</span>
      </div>
    </div>

    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="name">Full Name</label>
        <input
          type="text"
          id="name"
          formControlName="name"
          class="form-control"
          [ngClass]="{
            'is-invalid':
              checkoutForm.get('name')?.invalid &&
              checkoutForm.get('name')?.touched
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="
            checkoutForm.get('name')?.invalid &&
            checkoutForm.get('name')?.touched
          "
        >
          Full name is required
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-control"
          [ngClass]="{
            'is-invalid':
              checkoutForm.get('email')?.invalid &&
              checkoutForm.get('email')?.touched
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="
            checkoutForm.get('email')?.invalid &&
            checkoutForm.get('email')?.touched
          "
        >
          Please enter a valid email
        </div>
      </div>

      <div class="form-group">
        <label for="address">Address</label>
        <input
          type="text"
          id="address"
          formControlName="address"
          class="form-control"
          [ngClass]="{
            'is-invalid':
              checkoutForm.get('address')?.invalid &&
              checkoutForm.get('address')?.touched
          }"
        />
        <div
          class="invalid-feedback"
          *ngIf="
            checkoutForm.get('address')?.invalid &&
            checkoutForm.get('address')?.touched
          "
        >
          Address is required
        </div>
      </div>

      <div class="row">
        <div class="col">
          <div class="form-group">
            <label for="city">City</label>
            <input
              type="text"
              id="city"
              formControlName="city"
              class="form-control"
              [ngClass]="{
                'is-invalid':
                  checkoutForm.get('city')?.invalid &&
                  checkoutForm.get('city')?.touched
              }"
            />
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label for="state">State</label>
            <input
              type="text"
              id="state"
              formControlName="state"
              class="form-control"
              [ngClass]="{
                'is-invalid':
                  checkoutForm.get('state')?.invalid &&
                  checkoutForm.get('state')?.touched
              }"
            />
          </div>
        </div>
        <div class="col">
          <div class="form-group">
            <label for="zip">ZIP Code</label>
            <input
              type="text"
              id="zip"
              formControlName="zip"
              class="form-control"
              [ngClass]="{
                'is-invalid':
                  checkoutForm.get('zip')?.invalid &&
                  checkoutForm.get('zip')?.touched
              }"
            />
          </div>
        </div>
      </div>

      <div class="payment-section">
        <h3>Payment Information</h3>

        <!-- Or use a simple div for the card element -->
        <div *ngIf="!clientSecret" class="form-group">
          <label for="card-element">Credit or debit card</label>
          <div id="card-element" class="stripe-element"></div>
        </div>
      </div>

      <div class="alert alert-danger" *ngIf="paymentError">
        {{ paymentError }}
      </div>

      <div class="alert alert-success" *ngIf="paymentSuccess">
        Payment successful! Thank you for your order.
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="
          checkoutForm.invalid || !isCardComplete || isLoading || paymentSuccess
        "
      >
        <span
          *ngIf="isLoading"
          class="spinner-border spinner-border-sm"
          role="status"
          aria-hidden="true"
        ></span>
        {{ isLoading ? "Processing..." : "Complete Payment" }}
      </button>
    </form>
  </div>
</div>
