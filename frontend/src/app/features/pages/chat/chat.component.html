<!-- src/app/features/pages/chat/chat.component.html -->
<div class="chat-page" [ngClass]="{ 'dark-theme': isDarkMode }">
  <div class="chat-container">
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>Messages</h2>
      </div>

      <div class="contacts-search">
        <div class="search-input">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input type="text" placeholder="Search contacts..." />
        </div>
      </div>

      <div class="contacts-list">
        <div class="loading-spinner" *ngIf="isLoading">
          <div class="spinner"></div>
          <span>Loading contacts...</span>
        </div>

        <div class="no-contacts" *ngIf="!isLoading && contacts.length === 0">
          <p>No contacts found</p>
        </div>

        <div
          class="contact-item"
          *ngFor="let contact of contacts"
          [ngClass]="{ active: selectedContact?.id === contact.id }"
          (click)="selectContact(contact)"
        >
          <div class="contact-avatar">
            <img
              *ngIf="contact.avatar.startsWith('http')"
              [src]="contact.avatar"
              alt="avatar"
            />
            <div
              *ngIf="!contact.avatar.startsWith('http')"
              class="avatar-placeholder"
            >
              {{ contact.avatar }}
            </div>
          </div>
          <div class="contact-info">
            <div class="contact-name">{{ contact.name }}</div>
            <div class="contact-role">{{ contact.role }}</div>
          </div>
          <div class="contact-status" [ngClass]="{ online: true }"></div>
        </div>
      </div>
    </div>

    <div class="chat-main">
      <div class="chat-header" *ngIf="selectedContact">
        <div class="contact-info">
          <div class="contact-avatar">
            <img
              *ngIf="selectedContact.avatar.startsWith('http')"
              [src]="selectedContact.avatar"
              alt="avatar"
            />
            <div
              *ngIf="!selectedContact.avatar.startsWith('http')"
              class="avatar-placeholder"
            >
              {{ selectedContact.avatar }}
            </div>
          </div>
          <div class="contact-details">
            <div class="contact-name">{{ selectedContact.name }}</div>
            <div class="contact-status-text">
              <span
                class="status-indicator"
                [ngClass]="{ online: true }"
              ></span>
              <span>Online</span>
            </div>
          </div>
        </div>
        <div class="header-actions">
          <button class="icon-button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="1"></circle>
              <circle cx="19" cy="12" r="1"></circle>
              <circle cx="5" cy="12" r="1"></circle>
            </svg>
          </button>
        </div>
      </div>

      <div class="chat-body">
        <div class="no-chat-selected" *ngIf="!selectedContact">
          <div class="empty-state">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="60"
              height="60"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
              ></path>
            </svg>
            <h3>Your Messages</h3>
            <p>Select a contact to start messaging</p>
          </div>
        </div>

        <div
          class="message-container"
          #messageContainer
          *ngIf="selectedContact"
        >
          <div class="message-list">
            <div class="message-date-divider">
              <span>Today</span>
            </div>

            <div
              class="message-wrapper"
              *ngFor="let message of messages"
              [ngClass]="{
                outgoing: isMyMessage(message),
                incoming: !isMyMessage(message)
              }"
            >
              <div class="message">
                <div class="message-content">{{ message.text }}</div>
                <div class="message-time">
                  {{ formatTime(message.createdAt) }}
                </div>
              </div>
            </div>

            <div class="typing-indicator" *ngIf="typingUser">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
              <div class="typing-text">{{ typingUser }} is typing...</div>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-footer" *ngIf="selectedContact">
        <div class="message-composer">
          <button
            class="composer-button emoji-button"
            (click)="toggleEmojiPicker()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="22"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
              <line x1="9" y1="9" x2="9.01" y2="9"></line>
              <line x1="15" y1="9" x2="15.01" y2="9"></line>
            </svg>
          </button>

          <div class="composer-input">
            <input
              type="text"
              [(ngModel)]="messageText"
              (input)="onInputChange()"
              placeholder="Type a message..."
              (keyup.enter)="sendMessage()"
            />
          </div>

          <button
            class="composer-button send-button"
            (click)="sendMessage()"
            [disabled]="!messageText.trim()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="22"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>

      <div class="emoji-picker-container" *ngIf="showEmojiPicker">
        <emoji-mart
          [darkMode]="isDarkMode"
          [perLine]="8"
          [isNative]="true"
          (emojiSelect)="addEmoji($event)"
        >
        </emoji-mart>
      </div>
    </div>
  </div>
</div>
