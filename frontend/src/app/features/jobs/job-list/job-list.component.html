<!-- src/app/features/jobs/job-list/job-list.component.html -->
<app-banner>
  <h1>Find AI Projects</h1>
  <p>{{ userRole === "client" ? "My Posted Jobs" : "Explore AI Projects" }}</p>
</app-banner>

<div
  class="section job-list-page"
  [ngClass]="{
    'dark-theme': isDarkMode,
    client: userRole === 'client',
    talent: userRole === 'talent'
  }"
>
  <div class="section-container">
    <!-- Filters -->
    <div class="filter-section">
      <div class="filter-container">
        <div class="filter-item">
          <label for="status-filter">Status</label>
          <select
            id="status-filter"
            class="form-control"
            [value]="filterOptions.status"
            (change)="updateFilter('status', $event)"
          >
            <option value="all">All</option>
            <option value="published">Published</option>
            <option value="draft" *ngIf="userRole === 'client'">Draft</option>
            <option value="assigned" *ngIf="userRole === 'client'">
              Assigned
            </option>
            <option value="completed" *ngIf="userRole === 'client'">
              Completed
            </option>
          </select>
        </div>

        <div class="filter-item">
          <label for="sort-filter">Sort By</label>
          <select
            id="sort-filter"
            class="form-control"
            [value]="filterOptions.sortBy"
            (change)="updateFilter('sortBy', $event)"
          >
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="budget_high">Budget: High to Low</option>
            <option value="budget_low">Budget: Low to High</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading jobs...</p>
    </div>

    <!-- Error message -->
    <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <!-- Empty state for clients -->
    <div
      *ngIf="!isLoading && jobs.length === 0 && userRole === 'client'"
      class="empty-state"
    >
      <h3>You haven't posted any jobs yet</h3>
      <p>
        Create your first job listing to find talented professionals for your
        project.
      </p>
      <app-button type="primary" [routerLink]="['/jobs/post']">
        Post Your First Job
      </app-button>
    </div>

    <!-- Empty state for talents -->
    <div
      *ngIf="!isLoading && jobs.length === 0 && userRole === 'talent'"
      class="empty-state"
    >
      <h3>No available jobs found</h3>
      <p>
        There are no jobs matching your criteria at the moment. Check back later
        or update your search.
      </p>
    </div>

    <!-- Job Grid -->
    <div *ngIf="!isLoading && jobs.length > 0" class="job-list">
      <!-- Client View -->
      <div *ngIf="userRole === 'client'" class="job-cards">
        <div *ngFor="let job of jobs" class="job-card">
          <div class="job-card-header">
            <h3 class="job-title">{{ job.title }}</h3>
            <span class="job-status" [ngClass]="'status-' + job.status">
              {{ job.status | titlecase }}
            </span>
          </div>

          <div class="job-card-body">
            <p class="job-description">
              {{ job.description | slice : 0 : 150
              }}{{ job.description.length > 150 ? "..." : "" }}
            </p>

            <div class="job-meta">
              <div class="meta-item">
                <span class="meta-label">Budget:</span>
                <span class="meta-value">${{ job.budget }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Posted:</span>
                <span class="meta-value">{{ job.createdAt | date }}</span>
              </div>
            </div>

            <div class="job-stats" *ngIf="job.applications?.length">
              <span class="applications-badge">
                {{ job.applications.length }} application(s)
              </span>
            </div>
          </div>

          <div class="job-card-footer">
            <app-button type="success" (click)="openJobDetails(job)">
              Show More
            </app-button>
            <app-button type="secondary" [routerLink]="['/jobs', job._id]">
              View Details
            </app-button>
            <app-button
              *ngIf="job.status === 'draft'"
              type="secondary"
              [routerLink]="['/jobs', job._id, 'edit']"
            >
              Edit
            </app-button>
          </div>
        </div>
      </div>

      <!-- Talent View -->
      <div *ngIf="userRole === 'talent'" class="job-cards">
        <div *ngFor="let job of jobs" class="job-card">
          <div class="job-card-header">
            <h3 class="job-title">{{ job.title }}</h3>
            <span
              *ngIf="job.status"
              class="job-status"
              [ngClass]="'status-' + job.status"
            >
              {{ job.status | titlecase }}
            </span>
          </div>

          <div class="job-card-body">
            <p class="job-description">
              {{ job.description | slice : 0 : 150
              }}{{ job.description.length > 150 ? "..." : "" }}
            </p>

            <div class="job-meta">
              <div class="meta-item">
                <span class="meta-label">Budget:</span>
                <span class="meta-value">${{ job.budget }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Posted:</span>
                <span class="meta-value">{{ job.createdAt | date }}</span>
              </div>
            </div>

            <div class="skills-list" *ngIf="job.skills?.length">
              <span class="skill-tag" *ngFor="let skill of job.skills">
                {{ skill }}
              </span>
            </div>
          </div>

          <div class="job-card-footer">
            <app-button (click)="openJobDetails(job)">View Details</app-button>
            <app-button type="primary" [routerLink]="['/jobs', job._id]">
              Apply Now
            </app-button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button
        class="pagination-btn"
        [disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)"
      >
        Previous
      </button>

      <div class="pagination-pages">
        <span>Page {{ currentPage }} of {{ totalPages }}</span>
      </div>

      <button
        class="pagination-btn"
        [disabled]="currentPage === totalPages"
        (click)="changePage(currentPage + 1)"
      >
        Next
      </button>
    </div>
  </div>
</div>

<!-- Job Drawer (slide-in) -->
<div class="job-detail-drawer" *ngIf="selectedJob">
  <div class="drawer-overlay" (click)="closeJobDetails()"></div>

  <div class="drawer-panel">
    <div class="drawer-header">
      <h2>{{ selectedJob.title }}</h2>
      <button class="close-btn" (click)="closeJobDetails()">Ã—</button>
    </div>

    <div class="drawer-body">
      <p>{{ selectedJob.description }}</p>
      <p><strong>Budget:</strong> ${{ selectedJob.budget }}</p>
      <p><strong>Status:</strong> {{ selectedJob.status | titlecase }}</p>
      <p><strong>Posted:</strong> {{ selectedJob.createdAt | date }}</p>
    </div>
  </div>
</div>
